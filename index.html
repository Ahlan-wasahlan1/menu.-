<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø·Ø¹Ù… Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&family=Aref+Ruqaa:wght@700&display=swap" rel="stylesheet">
  
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
  
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        cairo: ['Cairo', 'sans-serif'],
                        ruqaa: ['Aref Ruqaa', 'serif']
                    },
                    colors: {
                        brand: { 
                            red: '#c02626',
                            dark: '#7f1d1d',
                            gold: '#f59e0b',
                            bg: '#fff7ed',
                            orange: '#ffedd5',
                            night: '#111827'
                        }
                    },
                    boxShadow: {
                        'soft': '0 5px 20px -5px rgba(0, 0, 0, 0.1)',
                        'floating': '0 10px 30px -5px rgba(192, 38, 38, 0.25)',
                    },
                    animation: {
                        'jump': 'jump 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards',
                    },
                    keyframes: {
                        'jump': {
                            '0%': { transform: 'translateY(0) scale(1)' },
                            '50%': { transform: 'translateY(-20px) scale(1.1)' },
                            '100%': { transform: 'translateY(-10px) scale(1.05)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Cairo', sans-serif; padding-bottom: 140px; background-color: #fff7ed; -webkit-tap-highlight-color: transparent; transition: background-color 0.5s ease; }
        html.dark body { background-color: #111827; color: #f3f4f6; }
        html.dark .bg-white { background-color: #1f2937 !important; border-color: #374151 !important; color: #f3f4f6 !important; }
        html.dark .text-gray-800 { color: #f3f4f6 !important; }
        html.dark .text-gray-500 { color: #9ca3af !important; }
        html.dark .border-orange-50 { border-color: #374151 !important; }
        .food-img { width: 110px; height: 110px; object-fit: cover; border-radius: 16px; flex-shrink: 0; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .clickable-card { position: relative; transition: transform 0.2s; cursor: pointer; overflow: hidden; background: white; }
        .clickable-card:active { transform: scale(0.98); background-color: #fff1f2; }
        .btn-control { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; font-weight: 900; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 10; }
        .btn-add { background-color: #c02626; color: white; border: none; }
        .btn-remove { background-color: white; color: #c02626; border: 2px solid #fee2e2; }
        .qty-display { font-weight: 800; font-size: 1.1rem; min-width: 24px; text-align: center; color: #7f1d1d; }
        .tab-switcher { background: #e5e7eb; padding: 5px; border-radius: 16px; display: flex; box-shadow: inset 0 2px 4px rgba(0,0,0,0.05); margin: 0 10px; }
        html.dark .tab-switcher { background: #374151; }
        .tab-btn { flex: 1; padding: 10px; border-radius: 12px; font-weight: 700; transition: all 0.3s ease; text-align: center; font-size: 0.9rem; }
        .tab-btn.active { background: white; color: #c02626; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transform: scale(1.02); }
        html.dark .tab-btn.active { background: #111827; color: #f59e0b; }
        .tab-btn.inactive { color: #6b7280; }
        .hero-slider-container { position: relative; height: 220px; border-radius: 2rem; overflow: hidden; margin-bottom: 1rem; box-shadow: 0 10px 30px -5px rgba(192, 38, 38, 0.25); }
        .slide { position: absolute; inset: 0; opacity: 0; transition: opacity 0.8s ease-in-out; width: 100%; height: 100%; display: none; }
        .slide.active { opacity: 1; display: block; }
        .slide-img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.50); }
        .slide-content { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; items-center; text-align: center; padding: 1rem; z-index: 10; }
        .slider-dots { position: absolute; bottom: 15px; left: 0; right: 0; display: flex; justify-content: center; gap: 8px; z-index: 20; }
        .dot { width: 8px; height: 8px; background: rgba(255,255,255,0.4); border-radius: 50%; transition: all 0.3s; cursor: pointer; }
        .dot.active { background: #f59e0b; width: 25px; border-radius: 10px; }
        .slider-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; z-index: 25; font-size: 1.2rem; transition: background 0.2s; }
        .slider-arrow:hover { background: rgba(255,255,255,0.4); }
        .arrow-right { right: 10px; }
        .arrow-left { left: 10px; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.98); backdrop-filter: blur(12px); height: 80px; display: flex; justify-content: space-around; items-center; border-top-left-radius: 25px; border-top-right-radius: 25px; box-shadow: 0 -5px 30px rgba(0,0,0,0.08); z-index: 50; padding-bottom: 5px; border-top: 1px solid rgba(0,0,0,0.05); }
        html.dark .bottom-nav { background: rgba(31, 41, 55, 0.98); border-top: 1px solid #374151; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #9ca3af; font-size: 0.7rem; font-weight: 700; gap: 4px; width: 60px; cursor: pointer; }
        .nav-item:active { color: #c02626; transform: scale(0.95); }
        .nav-icon { font-size: 1.5rem; }
        .nav-item.center-cart .nav-icon { background: white; color: #c02626; width: 55px; height: 55px; border-radius: 50%; border: 2px solid #f3f4f6; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: all 0.3s ease; position: relative; }
        html.dark .nav-item.center-cart .nav-icon { background: #1f2937; border-color: #374151; color: white; }
        .nav-item.center-cart.popped .nav-icon { animation: jump 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; background: #c02626; color: white; border-color: #fff7ed; box-shadow: 0 10px 25px rgba(192, 38, 38, 0.5); }
        #miniCheckoutBar { position: fixed; bottom: 120px; left: 15px; right: 15px; background: #1f2937; color: white; border-radius: 18px; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 15px 40px -10px rgba(0,0,0,0.3); z-index: 40; transform: translateY(200%); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); height: 60px; }
        #miniCheckoutBar.visible { transform: translateY(0); }
        html.dark #miniCheckoutBar { background: #111827; border: 1px solid #f59e0b; color: white; }
        .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); z-index: 3000; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s; }
        .modal-content { background: white; width: 95%; max-width: 420px; border-radius: 28px; padding: 0; transform: scale(0.9); transition: transform 0.3s; max-height: 90vh; display: flex; flex-direction: column; overflow: hidden; }
        .modal-open { display: flex !important; opacity: 1 !important; }
        .modal-open .modal-content { transform: scale(1) !important; }
        .payment-card { border: 1px solid #e5e7eb; border-radius: 16px; padding: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 5px; background: #f9fafb; transition: all 0.2s; cursor: pointer; height: 100px; }
        .payment-card:active { border-color: #c02626; background: #fff1f2; }
        .payment-logo-img { height: 35px; object-fit: contain; }
        .cat-card-new { position: relative; height: 140px; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 20px -5px rgba(0,0,0,0.15); transition: transform 0.2s; cursor: pointer; margin-bottom: 12px; }
        .cat-card-bg { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
        .cat-overlay { position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.75) 0%, transparent 100%); display: flex; align-items: flex-end; justify-content: center; padding-bottom: 15px; }
        .cat-title { color: white; font-family: 'Aref Ruqaa', serif; font-size: 1.8rem; text-shadow: 0 2px 4px rgba(0,0,0,0.6); }
        .menu-item-new { background: white; padding: 10px; border-radius: 16px; border: 1px solid #f3f4f6; display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .menu-price-new { background: #fff1f2; color: #991b1b; padding: 3px 8px; border-radius: 6px; font-weight: 800; font-size: 0.9rem; }
        .hidden-view { display: none; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .filter-chip { padding: 6px 16px; border-radius: 50px; font-weight: 700; font-size: 0.85rem; transition: all 0.2s; border: 1px solid transparent; cursor: pointer; white-space: nowrap; }
        .filter-chip.active { background: #c02626; color: white; box-shadow: 0 4px 10px rgba(192, 38, 38, 0.3); }
        .filter-chip.inactive { background: #fff; color: #6b7280; border-color: #e5e7eb; }
        html.dark .filter-chip.inactive { background: #1f2937; color: #9ca3af; border-color: #374151; }
        .nav-badge { position: absolute; top: -5px; right: -5px; background-color: #f59e0b; color: #111827; font-size: 0.7rem; font-weight: 900; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 2px solid white; z-index: 60; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        html.dark .nav-badge { border-color: #1f2937; color: white; background: #c02626; }
    </style>
</head>
<body class="text-gray-800 antialiased selection:bg-brand-red selection:text-white">
    <script>
        const LANG = {
            ar: {
                app_title: "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹",
                search_ph: "Ø§Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¬Ø¨ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©...",
                main_menu: "Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ“‹",
                sections: "Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø·Ø¹Ø§Ù… ğŸ½ï¸",
                total: "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",
                complete_order: "Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ âœ…",
                whatsapp: "ÙˆØ§ØªØ³Ø§Ø¨",
                share: "Ù…Ø´Ø§Ø±ÙƒØ©",
                cart: "Ø§Ù„Ø³Ù„Ø©",
                search: "Ø¨Ø­Ø«",
                settings: "Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
                profile_title: "Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ",
                dark_mode: "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ™",
                language: "Ø§Ù„Ù„ØºØ© / Language",
                bill_title: "ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ ğŸ§¾",
                confirm_pay: "ØªØ£ÙƒÙŠØ¯ ÙˆÙ…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ø¯ÙØ¹ ğŸ’³",
                pay_method_title: "Ø§Ø®ØªØ± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹",
                back: "ğŸ”™ Ø±Ø¬ÙˆØ¹",
                location_btn: "ğŸ“ Ø§Ø¶ØºØ· Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ (Ø¥Ù„Ø²Ø§Ù…ÙŠ)",
                location_wait: "â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¯ÙŠØ¯...",
                location_done: "âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹",
                location_fail: "ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹",
                location_alert: "ğŸ”´ Ø¹Ø°Ø±Ø§Ù‹ØŒ ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø£ÙˆÙ„Ø§Ù‹.",
                reminder: "âš ï¸ ØªØ°ÙƒÙŠØ± Ù‡Ø§Ù…:\nÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Ø§Ù„Ø³Ù†Ø¯) Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©.",
                share_msg: "Ø¨Ø·Ù„Ø¨ Ù…Ù† Ù…Ø·Ø¹Ù… Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹.. Ù…Ù† ÙŠØ·Ù„Ø¨ Ù…Ø¹ÙŠØŸ ğŸ˜‹",
                share_idle: "Ø¬Ø±Ø¨ÙˆØ§ Ù…Ø·Ø¹Ù… Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹!",
                empty_cart: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!",
                clear_cart: "Ø¥ÙØ±Ø§Øº Ø§Ù„Ø³Ù„Ø©ØŸ",
                cat_back: "ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø£Ù‚Ø³Ø§Ù…",
                most_ordered: "Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹ â­",
                cash: "ÙƒØ§Ø´",
                order_history: "Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©",
                no_history: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©",
                reorder: "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨ ğŸ”„",
                get_offer: "ğŸ”¥ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†",
                offer_req: "Ø·Ù„Ø¨ Ø¹Ø±Ø¶ Ø®Ø§Øµ",
                haptic_mode: "Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² ğŸ“³",
                all: "Ø§Ù„ÙƒÙ„ â™¾ï¸",
                breakfast: "ÙØ·ÙˆØ± ğŸ³",
                lunch: "ØºØ¯Ø§Ø¡ ğŸ—",
                dinner: "Ø¹Ø´Ø§Ø¡ ğŸ”",
                quick_reorder: "Ø·Ù„Ø¨ Ø³Ø±ÙŠØ¹ (Ø¢Ø®Ø± Ø·Ù„Ø¨ÙŠÙ†)",
                notes_placeholder: "Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„ØŒ ÙƒØ«Ø± Ø§Ù„Ø´Ø·Ø©...)",
                archive_btn: "ğŸ“‚ Ø¹Ø±Ø¶ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",
                clear_history: "ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„",
                reminder_modal_title: "ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø¯ÙØ¹",
                reminder_modal_body: "Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„Ø­ÙˆØ§Ù„Ø© (Ø§Ù„Ø³Ù†Ø¯) Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨.",
                i_understand: "Ø­Ø³Ù†Ø§Ù‹ØŒ ÙÙ‡Ù…Øª ğŸ‘"
            },
            en: {
                app_title: "Ahlan Restaurant",
                search_ph: "Search for food...",
                main_menu: "Main Menu ğŸ“‹",
                sections: "Categories ğŸ½ï¸",
                total: "Total",
                complete_order: "Checkout âœ…",
                whatsapp: "WhatsApp",
                share: "Share",
                cart: "Cart",
                search: "Search",
                settings: "Settings",
                profile_title: "Profile",
                dark_mode: "Dark Mode ğŸŒ™",
                language: "Language / Ø§Ù„Ù„ØºØ©",
                bill_title: "Order Bill ğŸ§¾",
                confirm_pay: "Confirm & Pay ğŸ’³",
                pay_method_title: "Payment Method",
                back: "ğŸ”™ Back",
                location_btn: "ğŸ“ Auto-Locate (Required)",
                location_wait: "â³ Locating...",
                location_done: "âœ… Location Set",
                location_fail: "Location Failed",
                location_alert: "ğŸ”´ Sorry, Location is required.",
                reminder: "âš ï¸ Reminder:\nPlease send the transfer receipt immediately after this message.",
                share_msg: "Ordering from Ahlan.. Who's in? ğŸ˜‹",
                share_idle: "Try Ahlan Restaurant!",
                empty_cart: "Cart is empty!",
                clear_cart: "Clear cart?",
                cat_back: "ğŸ”™ Back",
                most_ordered: "Best Seller â­",
                cash: "Cash",
                order_history: "Order History",
                no_history: "No previous orders",
                reorder: "Re-order ğŸ”„",
                get_offer: "ğŸ”¥ Get Offer Now",
                offer_req: "Special Offer Request",
                haptic_mode: "Haptic Feedback ğŸ“³",
                all: "All",
                breakfast: "Breakfast",
                lunch: "Lunch",
                dinner: "Dinner",
                quick_reorder: "Quick Re-order",
                notes_placeholder: "Extra notes (e.g., No onion, extra spicy...)",
                archive_btn: "ğŸ“‚ Show Order Archive",
                clear_history: "ğŸ—‘ï¸ Clear History",
                reminder_modal_title: "Payment Reminder",
                reminder_modal_body: "Please remember to attach the transfer receipt immediately after sending the order on WhatsApp.",
                i_understand: "OK, I Understand ğŸ‘"
            }
        };

        window.OFFERS_DATA = [
            { id:1, img: "https://i.postimg.cc/c4cw1RSk/sddefault-(4).jpg", titleAr: "Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© ğŸ—", titleEn: "Family Deal ğŸ—", subtitleAr: "Ø§Ø´ØªØ±ÙŠ 3 Ø¯Ø¬Ø§Ø¬ Ø´ÙˆØ§ÙŠØ© Ø¨Ø³Ø¹Ø± 2 ÙÙ‚Ø·!", subtitleEn: "Buy 3 Grilled Chicken for price of 2!", price: 7000 },
            { id:2, img: "https://i.postimg.cc/4xhb24pp/maxresdefault.jpg", titleAr: "Ù…Ù†Ø¯ÙŠ ØªÙŠØ³ Ø¨Ù„Ø¯ÙŠ", titleEn: "Mandi Goat Meat", subtitleAr: "Ø³Ø¹Ø± Ø§Ù„Ù†ÙØ± 7500 Ø±ÙŠØ§Ù„ (Ù„Ù…Ø¯Ø© 24 Ø³Ø§Ø¹Ø©) ğŸ”¥", subtitleEn: "Portion for 7500 YER (24 Hours) ğŸ”¥", price: 7500 },
            { id:3, img: "https://i.ibb.co/MxHKwrX1/Best-Burgers-in-Ras-Al-Khaimah-Cover-28-092025ar.jpg", titleAr: "Ø¹Ø´Ø§Ù‚ Ø§Ù„Ø¨Ø±Ø¬Ø± ğŸ”", titleEn: "Burger Lovers ğŸ”", subtitleAr: "Ø§Ø·Ù„Ø¨ ÙˆØ¬Ø¨ØªÙŠÙ† ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ¨Ø³ÙŠ Ù…Ø¬Ø§Ù†Ø§Ù‹", subtitleEn: "Order 2 meals get free Pepsi", price: 3000 }
        ];
    </script>

    <!-- App Banner -->
    <div class="bg-gradient-to-r from-gray-900 to-gray-800 text-white px-4 py-2.5 flex justify-between items-center shadow-md relative z-[60]">
        <div class="flex items-center gap-2">
            <span class="text-lg">ğŸ“²</span>
            <div>
                <p class="text-[10px] text-gray-400 font-bold leading-none mb-0.5">ØªØ¬Ø±Ø¨Ø© Ø£ÙØ¶Ù„ ÙˆØ£Ø³Ø±Ø¹</p>
                <p class="text-xs font-bold text-white">Ø­Ù…Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø·Ø¹Ù… Ø§Ù„Ø¢Ù†!</p>
            </div>
        </div>
        <a href="#" class="bg-brand-gold text-brand-dark text-xs px-4 py-1.5 rounded-full font-black hover:bg-yellow-400 transition transform hover:scale-105 shadow-[0_0_15px_rgba(245,158,11,0.4)]">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ â†“</a>
    </div>

    <!-- Top Bar -->
    <nav class="bg-white/95 backdrop-blur-xl shadow-sm sticky top-0 z-50 px-5 py-3 flex justify-between items-center rounded-b-3xl border-b border-orange-100/50 dark:bg-gray-800/95 dark:border-gray-700">
        <div class="flex items-center gap-3">
            <img src="https://i.postimg.cc/9MScVN85/Screenshot-20251216-113344-Whats-App.png" class="w-12 h-12 rounded-xl shadow-md border-2 border-white object-cover">
            <div class="font-extrabold text-xl text-brand-dark dark:text-white" data-lang="app_title">Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹</div>
        </div>
        <a href="tel:967779100056" class="bg-brand-red text-white w-10 h-10 rounded-full flex items-center justify-center shadow-md animate-pulse border-2 border-orange-200">ğŸ“</a>
    </nav>

    <!-- Hero Section -->
    <div id="hero-container" class="mx-3 mt-4 mb-4"></div>

    <!-- â• MEAL FILTERS -->
    <div class="px-4 mb-2 flex gap-2 overflow-x-auto pb-2 no-scrollbar" id="meal-filters">
        <button onclick="filterMenu('all')" class="filter-chip active" id="filter-all" data-lang="all">Ø§Ù„ÙƒÙ„ â™¾ï¸</button>
        <button onclick="filterMenu('breakfast')" class="filter-chip inactive" id="filter-breakfast" data-lang="breakfast">ÙØ·ÙˆØ± ğŸ³</button>
        <button onclick="filterMenu('lunch')" class="filter-chip inactive" id="filter-lunch" data-lang="lunch">ØºØ¯Ø§Ø¡ ğŸ—</button>
        <button onclick="filterMenu('dinner')" class="filter-chip inactive" id="filter-dinner" data-lang="dinner">Ø¹Ø´Ø§Ø¡ ğŸ”</button>
    </div>

    <!-- Tabs -->
    <div class="sticky top-[75px] z-40 bg-[#fff7ed] pb-2 pt-1 px-1 dark:bg-gray-900 transition-colors">
        <div class="tab-switcher">
            <button onclick="switchView('main')" id="btn-main" class="tab-btn active" data-lang="main_menu">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ“‹</button>
            <button onclick="switchView('categories')" id="btn-categories" class="tab-btn inactive" data-lang="sections">Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø·Ø¹Ø§Ù… ğŸ½ï¸</button>
        </div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="container mx-auto px-4 py-4 mb-32">
        <div id="view-main" class="fade-in space-y-8">
            <div id="main-sections-container"></div>
        </div>
        <div id="view-categories" class="hidden-view fade-in">
            <div id="categories-grid" class="grid grid-cols-1 gap-4"></div>
            <div id="category-detail" class="hidden-view">
                <button onclick="showCategoriesGrid()" class="mb-4 bg-white text-brand-red px-5 py-2 rounded-full shadow-sm font-bold flex items-center gap-2 text-sm border border-gray-100 dark:bg-gray-800 dark:text-white dark:border-gray-600" data-lang="cat_back">ğŸ”™ Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø£Ù‚Ø³Ø§Ù…</button>
                <div class="relative h-32 rounded-2xl overflow-hidden mb-4 shadow-md">
                    <img id="cat-header-img" src="" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/50 flex items-center justify-center"><h3 id="cat-detail-title" class="font-ruqaa text-3xl text-white drop-shadow-lg"></h3></div>
                </div>
                <div id="full-menu-list" class="grid grid-cols-1 gap-2"></div>
            </div>
        </div>
    </div>

    <!-- Footer Rights -->
    <div class="text-center py-6 border-t border-gray-200 dark:border-gray-700 pb-36 mb-10">
        <p class="text-[10px] text-gray-400 font-bold mb-2">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Â© Ù„Ù…Ø·Ø¹Ù… Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ 2026</p>
        <a href="https://wa.me/967775904946?text=%D9%85%D8%B1%D8%AD%D8%A8%D8%A7%20%D9%81%D8%B1%D9%8A%D9%82%20Yemen%20Click%D8%8C%20%D8%B4%D9%81%D8%AA%20%D8%B4%D8%BA%D9%84%D9%83%D9%85%20%D9%81%D9%8A%20%D9%85%D8%B7%D8%B9%D9%85%20%D8%A3%D9%87%D9%84%D8%A7%D9%8B%20%D9%88%D8%B3%D9%87%D9%84%D8%A7%D9%8B%20%D9%88%D8%A3%D8%B1%D9%8A%D8%AF%20%D9%85%D9%88%D9%82%D8%B9%20%D8%AE%D8%A7%D8%B5%20%D9%84%D9%85%D8%B4%D8%B1%D9%88%D8%B9%D9%8A..." target="_blank" class="bg-stone-200 text-gray-700 px-6 py-2 rounded-xl shadow-sm text-xs font-black dark:bg-gray-700 dark:text-gray-300">YEMEN CLICK ğŸš€</a>
    </div>

    <!-- ğŸŒŸ FLOATING CHECKOUT BAR -->
    <div id="miniCheckoutBar">
        <div class="flex flex-col pl-4">
            <span class="text-[10px] text-gray-400 font-bold uppercase tracking-wider" data-lang="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
            <div class="font-black text-xl text-brand-gold flex items-baseline gap-1">
                <span id="mini-total">0</span> <span class="text-[10px] text-gray-400 dark:text-gray-800">Ø±.ÙŠ</span>
            </div>
        </div>
        <div class="flex items-center gap-3 w-1/2 justify-end">
            <button onclick="clearCart()" class="w-10 h-10 rounded-full bg-gray-700/50 flex items-center justify-center text-gray-400 hover:text-red-400 text-sm transition">ğŸ—‘ï¸</button>
            <button onclick="openPaymentWizard()" class="flex-1 bg-gradient-to-r from-brand-red to-red-600 text-white py-2 rounded-xl font-bold text-sm shadow-lg active:scale-95 transition" data-lang="complete_order">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
        </div>
    </div>

    <!-- ğŸ“± BOTTOM NAV -->
    <div class="bottom-nav">
        <a href="https://wa.me/967779100056" target="_blank" class="nav-item">
            <div class="nav-icon text-[#25D366]">ğŸ’¬</div><span data-lang="whatsapp">ÙˆØ§ØªØ³Ø§Ø¨</span>
        </a>
        <div class="nav-item" onclick="shareApp()">
            <div class="nav-icon text-gray-400">ğŸ“¤</div><span data-lang="share">Ù…Ø´Ø§Ø±ÙƒØ©</span>
        </div>
        <div class="nav-item center-cart" id="center-cart-btn" onclick="openPaymentWizard()">
            <div class="nav-icon relative">
                <span class="text-2xl">ğŸ›’</span>
                <span id="cart-badge" class="nav-badge scale-0">0</span>
            </div>
            <span class="text-brand-red font-bold mt-1 text-xs" data-lang="cart">Ø§Ù„Ø³Ù„Ø©</span>
        </div>
        <div class="nav-item" onclick="openSearchModal()">
            <div class="nav-icon text-gray-400">ğŸ”</div><span data-lang="search">Ø¨Ø­Ø«</span>
        </div>
        <div class="nav-item" onclick="openSettingsModal()">
            <div class="nav-icon text-gray-400">âš™ï¸</div><span data-lang="settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </div>
    </div>

    <!-- ğŸ’³ PAYMENT WIZARD MODAL -->
    <div id="paymentModal" class="modal-backdrop" onclick="closePaymentModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div id="step-review" class="flex flex-col h-full">
                <div class="p-4 border-b bg-gray-50 flex justify-between items-center dark:bg-gray-800 dark:border-gray-700">
                    <h3 class="font-black text-lg text-gray-800 dark:text-white" data-lang="bill_title">ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø¨ ğŸ§¾</h3>
                    <button onclick="closePaymentModal()" class="text-gray-400 font-bold text-2xl">âœ•</button>
                </div>
                <div class="p-4 bg-white dark:bg-gray-900 overflow-y-auto max-h-[60vh]">
                    <div id="bill-items" class="space-y-2 text-sm text-gray-600 dark:text-gray-300 mb-4"></div>
                    
                    <!-- â• NEW NOTES FIELD -->
                    <div class="mb-3">
                        <textarea id="order-notes" rows="2" data-lang="notes_placeholder" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ø«Ù„Ø§Ù‹: Ø¨Ø¯ÙˆÙ† Ø¨ØµÙ„ØŒ ÙƒØ«Ø± Ø§Ù„Ø´Ø·Ø©...)" class="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-brand-red dark:bg-gray-800 dark:border-gray-600 dark:text-white resize-none"></textarea>
                    </div>

                    <div class="flex justify-between items-center font-black text-xl text-brand-red border-t pt-3 dark:border-gray-700">
                        <span data-lang="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                        <span><span id="bill-total">0</span> Ø±.ÙŠ</span>
                    </div>
                </div>
                <div class="p-4 bg-gray-50 dark:bg-gray-800">
                    <button onclick="goToPaymentStep()" class="w-full bg-brand-red text-white py-3 rounded-xl font-bold shadow-lg" data-lang="confirm_pay">ØªØ£ÙƒÙŠØ¯ ÙˆÙ…ÙˆØ§ØµÙ„Ø© Ø§Ù„Ø¯ÙØ¹ ğŸ’³</button>
                </div>
            </div>
            <div id="step-payment" class="hidden flex flex-col h-full">
                <div class="p-4 border-b bg-gray-50 flex justify-between items-center dark:bg-gray-800 dark:border-gray-700">
                    <button onclick="backToReview()" class="text-sm font-bold text-gray-500 flex items-center gap-1" data-lang="back">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
                    <h3 class="font-black text-lg text-gray-800 dark:text-white" data-lang="pay_method_title">Ø§Ø®ØªØ± ÙˆØ³ÙŠÙ„Ø© Ø§Ù„Ø¯ÙØ¹</h3>
                </div>
                <div class="p-4 bg-white dark:bg-gray-900 overflow-y-auto">
                    <button id="btn-location" onclick="requestUserLocation()" class="w-full mb-6 bg-blue-50 text-blue-700 font-bold py-3 rounded-xl border border-blue-200 flex justify-center items-center gap-2 animate-pulse">
                        <span data-lang="location_btn">ğŸ“ Ø§Ø¶ØºØ· Ù„ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ (Ø¥Ù„Ø²Ø§Ù…ÙŠ)</span>
                    </button>
                    <div class="grid grid-cols-2 gap-3">
                        <div onclick="processPayment('jeeb')" class="col-span-2 h-28 relative rounded-2xl overflow-hidden cursor-pointer border-2 border-transparent hover:border-green-500 transition shadow-md group bg-gray-900">
                            <img src="https://i.postimg.cc/C1529s7c/1200x630wa.png" class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition duration-700 opacity-40">
                            <div class="absolute inset-0 flex flex-col justify-end p-4">
                                <span class="text-white font-black text-lg z-10">Ù…Ø­ÙØ¸Ø© Ø¬ÙŠØ¨</span>
                                <span class="bg-brand-gold text-brand-dark text-[10px] font-bold px-2 py-0.5 rounded w-max z-10" data-lang="most_ordered">Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ø§Ù‹ â­</span>
                            </div>
                        </div>
                        <div onclick="processPayment('cash')" class="payment-card dark:bg-gray-800 dark:border-gray-600">
                            <span class="text-3xl">ğŸ’µ</span>
                            <div class="text-center leading-3 mt-1"><div class="pay-text-ar dark:text-white" data-lang="cash">ÙƒØ§Ø´</div></div>
                        </div>
                        <div onclick="processPayment('mfloos')" class="payment-card dark:bg-gray-800 dark:border-gray-600">
                            <img src="https://i.postimg.cc/Gp87Qmmy/Ê¿mlaÊ¾-1.png" class="payment-logo-img">
                            <div class="text-center leading-3 mt-1"><div class="pay-text-ar dark:text-white">Ø¥Ù… ÙÙ„ÙˆØ³</div></div>
                        </div>
                        <div onclick="processPayment('jawali')" class="payment-card dark:bg-gray-800 dark:border-gray-600">
                            <img src="https://i.postimg.cc/JnHfGQXW/jawali.png" class="payment-logo-img">
                            <div class="text-center leading-3 mt-1"><div class="pay-text-ar dark:text-white">Ø¬ÙˆØ§Ù„ÙŠ</div></div>
                        </div>
                        <div onclick="processPayment('onecash')" class="payment-card dark:bg-gray-800 dark:border-gray-600">
                            <img src="https://i.postimg.cc/QNwM46mt/wan-kash.jpg" class="payment-logo-img rounded-md">
                            <div class="text-center leading-3 mt-1"><div class="pay-text-ar dark:text-white">ÙˆÙ† ÙƒØ§Ø´</div></div>
                        </div>
                        <div onclick="processPayment('floosak')" class="payment-card col-span-2 dark:bg-gray-800 dark:border-gray-600">
                            <img src="https://i.postimg.cc/hGvjZNky/Screenshot-20251226-163859-Google.jpg" class="payment-logo-img rounded-md">
                            <div class="text-center leading-3 mt-1"><div class="pay-text-ar dark:text-white">ÙÙ„ÙˆØ³Ùƒ</div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”” PAYMENT REMINDER MODAL (NEW) -->
    <div id="reminder-modal" class="modal-backdrop" style="z-index: 3100;" onclick="closeReminderModal()">
        <div class="modal-content w-[85%] max-w-sm p-5 text-center" onclick="event.stopPropagation()">
            <div class="text-4xl mb-2">âš ï¸</div>
            <h3 class="font-black text-xl text-gray-800 mb-2 dark:text-white" data-lang="reminder_modal_title">ØªØ°ÙƒÙŠØ± Ø¨Ø§Ù„Ø¯ÙØ¹</h3>
            <p class="text-gray-500 text-sm mb-6 dark:text-gray-300" data-lang="reminder_modal_body">Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„Ø­ÙˆØ§Ù„Ø© (Ø§Ù„Ø³Ù†Ø¯) Ø¨Ø¹Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨.</p>
            <button onclick="confirmPaymentReminder()" class="bg-brand-gold text-brand-dark w-full py-3 rounded-xl font-black shadow-lg" data-lang="i_understand">Ø­Ø³Ù†Ø§Ù‹ØŒ ÙÙ‡Ù…Øª ğŸ‘</button>
        </div>
    </div>

    <!-- âš™ï¸ SETTINGS MODAL -->
    <div id="settings-modal" class="modal-backdrop" onclick="closeSettingsModal(event)">
        <div class="modal-content h-auto self-end w-full max-w-full rounded-b-none rounded-t-[2rem]" onclick="event.stopPropagation()">
            <div class="p-5 border-b bg-gray-50 flex justify-between items-center dark:bg-gray-800 dark:border-gray-700">
                <h3 class="font-black text-xl text-gray-800 dark:text-white" data-lang="profile_title">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
                <button onclick="closeSettingsModal()" class="text-gray-400 font-bold text-2xl">âœ•</button>
            </div>
            <div class="bg-brand-red p-6 text-white text-center">
                <div class="w-24 h-24 bg-white/20 rounded-full mx-auto flex items-center justify-center mb-3 overflow-hidden border-4 border-white/10 relative cursor-pointer" onclick="document.getElementById('profile-upload').click()">
                    <img id="profile-img" src="" class="w-full h-full object-cover hidden">
                    <span id="profile-placeholder" class="text-3xl">ğŸ“·</span>
                </div>
                <input type="file" id="profile-upload" class="hidden" accept="image/*" onchange="uploadImage(this)">
                <input type="text" id="user-name" placeholder="Ø§Ø¶ØºØ· Ù„ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù…Ùƒ" class="bg-transparent text-center text-white font-black text-lg placeholder-white/70 outline-none w-full border-b border-white/20 pb-1 mb-2 focus:border-white" oninput="saveSettings()">
                <input type="tel" id="user-phone" placeholder="Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ" class="bg-transparent text-center text-white/80 font-bold text-sm placeholder-white/50 outline-none w-full" oninput="saveSettings()">
            </div>
            
            <div class="p-4 space-y-4 bg-white dark:bg-gray-900 overflow-y-auto max-h-[40vh]">
                <!-- â• QUICK REORDER SECTION (RED ZONE - UNTOUCHED) -->
                <div class="border-b pb-4 dark:border-gray-700">
                    <h4 class="font-bold text-xs text-brand-red mb-3 uppercase" data-lang="quick_reorder">Ø·Ù„Ø¨ Ø³Ø±ÙŠØ¹ (Ø¢Ø®Ø± Ø·Ù„Ø¨ÙŠÙ†)</h4>
                    <div id="quick-history-list" class="space-y-2"></div>
                </div>

                <!-- â• ARCHIVED HISTORY (BLUE ZONE - HIDDEN BY DEFAULT) -->
                <div class="border-b pb-4 dark:border-gray-700">
                    <button onclick="toggleArchive()" class="w-full bg-gray-100 text-gray-600 font-bold py-2 rounded-xl text-sm flex justify-between items-center px-4 mb-2 dark:bg-gray-800 dark:text-gray-300">
                        <span data-lang="archive_btn">ğŸ“‚ Ø¹Ø±Ø¶ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
                        <span id="archive-arrow">â–¼</span>
                    </button>
                    
                    <div id="archive-container" class="hidden space-y-2">
                        <button onclick="clearHistory()" class="w-full text-red-400 text-xs font-bold py-1 mb-2 text-right" data-lang="clear_history">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
                        <div id="history-list" class="space-y-2 text-center text-sm text-gray-500">
                            <span data-lang="no_history">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</span>
                        </div>
                    </div>
                </div>

                 <div class="flex justify-between items-center">
                    <span class="font-bold dark:text-white" data-lang="dark_mode">Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ™</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="dark-toggle" class="sr-only peer" onchange="toggleTheme()">
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:bg-brand-gold peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                    </label>
                </div>
                 <div class="flex justify-between items-center">
                    <span class="font-bold dark:text-white" data-lang="haptic_mode">Ø§Ù„Ø§Ù‡ØªØ²Ø§Ø² ğŸ“³</span>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="haptic-toggle" class="sr-only peer" onchange="toggleHaptic()" checked>
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:bg-green-500 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                    </label>
                </div>
                 <div class="flex justify-between items-center border-t pt-4 dark:border-gray-700">
                    <span class="font-bold dark:text-white" data-lang="language">Ø§Ù„Ù„ØºØ© / Language</span>
                    <button onclick="toggleLanguage()" class="bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full text-sm font-bold" id="lang-btn">English</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Modal -->
    <div id="search-modal" class="modal-backdrop">
        <div class="bg-white w-full h-full p-4 flex flex-col dark:bg-gray-900">
            <div class="flex items-center gap-3 mb-4">
                <button onclick="closeSearchModal()" class="w-10 h-10 rounded-full bg-gray-100 font-bold dark:bg-gray-800 dark:text-white">âœ•</button>
                <input type="text" id="real-search-input" class="flex-1 bg-gray-100 rounded-full px-5 py-3 font-bold dark:bg-gray-800 dark:text-white focus:outline-none" onkeyup="performSearch()">
            </div>
            <div id="search-results" class="grid grid-cols-1 gap-3 overflow-y-auto pb-20"></div>
        </div>
    </div>

    <script>
        // ================= UPDATED DATA =================
        const originalMenu = {
            grills: { titleAr: "Ø§Ù„Ù„Ø­ÙˆÙ… ÙˆØ§Ù„Ù…Ø´ÙˆÙŠØ§Øª", titleEn: "Grills & Meat", icon: "ğŸ”¥", tags: ['lunch', 'dinner'], items: [ 
                { nameAr: 'Ø¯Ø¬Ø§Ø¬ Ø´ÙˆØ§ÙŠØ©', nameEn: 'Rotisserie Chicken', price: 3500, descAr: 'ØªØ­Ù…ÙŠØ± Ø°Ù‡Ø¨ÙŠ Ù…Ø¹ Ø§Ù„Ø±Ø²', descEn: 'Golden roasted with rice', img: 'https://i.postimg.cc/c4cw1RSk/sddefault-(4).jpg' },
                { nameAr: 'ÙƒØ¨Ø§Ø¨ ØµÙ†Ø¹Ø§Ù†ÙŠ', nameEn: 'Sanani Kabab', price: 4000, descAr: 'Ù„Ø­Ù… Ø¨Ù„Ø¯ÙŠ Ø·Ø§Ø²Ø¬', descEn: 'Fresh local meat', img: 'https://i.postimg.cc/x8TwDpQV/kabab-Sanani-1.jpg' },
                { nameAr: 'Ø£ÙˆØµØ§Ù„ Ù„Ø­Ù…', nameEn: 'Meat Awsal', price: 3500, descAr: 'Ù…Ø´ÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ÙØ­Ù…', descEn: 'Charcoal grilled', img: 'https://images.unsplash.com/photo-1603360946369-dc9bb6258143?w=400&q=80' },
                { nameAr: 'Ø¨Ø±ÙˆØ³Øª', nameEn: 'Broasted Chicken', price: 1200, descAr: 'Ø·Ø§Ø²Ø¬ ÙˆÙ…Ù‚Ø±Ù…Ø´', descEn: 'Fresh and crispy', img: 'https://i.postimg.cc/rsXY09Z7/6f2bb906-a050-4fec-9b93-cc40f0de1c30.jpg' } 
            ]},
            folk: { titleAr: "Ø§Ù„Ø£ÙƒÙ„ Ø§Ù„Ø´Ø¹Ø¨ÙŠ", titleEn: "Folk Dishes", icon: "ğŸ²", tags: ['breakfast', 'lunch'], items: [
                { nameAr: 'Ø³Ù„ØªØ© ØµÙ†Ø¹Ø§Ù†ÙŠØ©', nameEn: 'Sanani Saltah', price: 1500, img: 'https://i.postimg.cc/tTc1WW7p/Almawqea2021-12-20-08-38-53-447539.jpg' },
                { nameAr: 'ÙØ­Ø³Ø© Ù„Ø­Ù…', nameEn: 'Meat Fahsa', price: 2500, img: 'https://i.postimg.cc/SxFRfmds/fhsh.webp' },
                { nameAr: 'Ø¹ØµÙŠØ¯ ÙˆÙ…Ø±Ù‚', nameEn: 'Asid & Broth', price: 2000, img: 'https://i.postimg.cc/rpXzVM34/sddefault.jpg' },
                { nameAr: 'Ù…Ø·Ø¨Ù‚', nameEn: 'Mutabbaq', price: 600, img: 'https://i.postimg.cc/L4kMkqkt/alswrt-alryysyt-lwsftmtbq-alymny-shl.jpg' }
            ]},
            rice: { titleAr: "Ø§Ù„Ø£Ø±Ø² ÙˆØ§Ù„ÙˆÙ„Ø§Ø¦Ù…", titleEn: "Rice & Feasts", icon: "ğŸš", tags: ['lunch'], items: [
                { nameAr: 'Ù…Ù†Ø¯ÙŠ Ù„Ø­Ù… ØªÙŠØ³', nameEn: 'Mandi Goat', price: 8500, descAr: 'Ù…Ù† Ø§Ù„ØªÙ†ÙˆØ± Ø±Ø£Ø³Ø§Ù‹ Ø¥Ù„ÙŠÙƒ', descEn: 'Fresh from Tandoor', img: 'https://i.postimg.cc/4xhb24pp/maxresdefault.jpg' },
                { nameAr: 'Ø²Ø±Ø¨ÙŠØ§Ù† Ø¹Ø¯Ù†ÙŠ', nameEn: 'Adeni Zurbian', price: 4500, descAr: 'Ø¨Ø§Ù„Ø²Ø¨Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø¨Ù‡Ø§Ø±Ø§Øª', descEn: 'With yogurt and spices', img: 'https://i.postimg.cc/9F9rvDNz/maxresdefault-(2).jpg' },
                { nameAr: 'Ø¨Ø±Ø¬Ø±', nameEn: 'Burger', price: 1000, descAr: 'Ø·Ø§Ø²Ø¬ Ù…Ø¹ Ø§Ù„Ø®Ø¶Ø§Ø±', descEn: 'Fresh with veggies', img: 'https://i.postimg.cc/zG8wLQDr/pngtree-breakfast-burger-with-bacon-and-egg-on-wood-top-image-2506924.jpg' }
            ]},
            edam: { titleAr: "Ø§Ù„Ø¥Ø¯Ø§Ù…Ø§Øª", titleEn: "Edam", icon: "ğŸ¥˜", tags: ['breakfast', 'dinner'], items: [
                { nameAr: 'ÙØ§ØµÙˆÙ„ÙŠØ§', nameEn: 'Beans', price: 1000, img: 'https://i.postimg.cc/sDKpg6RB/sddefault-(2).jpg' },
                { nameAr: 'Ø³Ù…Ùƒ ØªÙˆÙ†Ø©', nameEn: 'Tuna Fish', price: 1200, img: 'https://i.postimg.cc/6QzsjNsf/Screenshot-20251215-141250-Maps.jpg' },
                { nameAr: 'Ø´ÙƒØ´ÙˆÙƒØ©', nameEn: 'Shakshuka', price: 800, img: 'https://i.postimg.cc/6qrFZsh2/alqlayat-shkshwkt-byd-800x560.jpg' },
                { nameAr: 'Ù„Ø­Ù… ØµØºØ§Ø±', nameEn: 'Minced Meat', price: 1000, img: 'https://i.postimg.cc/Y9cXzn03/maxresdefault-(3).jpg' }
            ]},
            drinks: { titleAr: "Ø¹ØµØ§Ø¦Ø± ÙˆÙ…Ø´Ø±ÙˆØ¨Ø§Øª", titleEn: "Drinks", icon: "ğŸ¥¤", tags: ['all'], items: [
                { nameAr: 'Ø¹ØµÙŠØ± Ù„ÙŠÙ…ÙˆÙ†', nameEn: 'Lemon Juice', price: 150, img: 'https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?w=200&q=80' },
                { nameAr: 'Ø¹ØµÙŠØ± Ù…Ø§Ù†Ø¬Ùˆ', nameEn: 'Mango Juice', price: 300, img: 'https://images.unsplash.com/photo-1623065422902-30a2d299bbe4?w=200&q=80' },
                { nameAr: 'Ø¹ØµÙŠØ± Ø¬ÙˆØ§ÙØ©', nameEn: 'Guava Juice', price: 250, img: 'https://images.unsplash.com/photo-1534353473418-4cfa6c56fd38?w=200&q=80' },
                { nameAr: 'Ø¨ÙŠØ¨Ø³ÙŠ', nameEn: 'Pepsi', price: 300, img: 'https://images.unsplash.com/photo-1629203851122-3726ecdf080e?w=200&q=80' },
                { nameAr: 'Ø¹ØµÙŠØ± Ø¨Ø±ØªÙ‚Ø§Ù„', nameEn: 'Orange Juice', price: 200, img: 'https://i.postimg.cc/dVn1PprD/6385255.jpg' },
                { nameAr: '7 UP', nameEn: '7 UP', price: 300, img: 'https://i.postimg.cc/W1VnfFwc/Pepsi-Co-7UP-Global-Mixology-Campaign.jpg' }
            ]}
        };

        const fullMenu = {
            burger: { titleAr: "Ù‚Ø³Ù… Ø§Ù„Ø¨Ø±Ø¬Ø±", titleEn: "Burgers", img: "https://i.ibb.co/MxHKwrX1/Best-Burgers-in-Ras-Al-Khaimah-Cover-28-092025ar.jpg", items: [ { nameAr: 'Ø¨Ø±Ø¬Ø± Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ù…Ø§ÙƒØ³', nameEn: 'Ahlan Max Burger', price: 1800 }, { nameAr: 'Ø¨Ø±Ø¬Ø± Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹', nameEn: 'Ahlan Burger', price: 1300 }, { nameAr: 'Ø¨Ø±Ø¬Ø± Ø¯Ø¨Ù„ Ø¬Ø¨Ù†', nameEn: 'Double Cheese Burger', price: 1100 } ] },
            shawarma: { titleAr: "Ù‚Ø³Ù… Ø§Ù„Ø´Ø§ÙˆØ±Ù…Ø§", titleEn: "Shawarma", img: "https://i.postimg.cc/ZqCwdVWN/maxresdefault-(4).jpg", items: [ { nameAr: 'Ø´Ø§ÙˆØ±Ù…Ø§ Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹', nameEn: 'Ahlan Shawarma', price: 1500 }, { nameAr: 'ØµØ­Ù† Ø´Ø§ÙˆØ±Ù…Ø§ Ø¹Ø±Ø¨ÙŠ', nameEn: 'Arabic Shawarma Plate', price: 1300 } ] },
            chicken: { titleAr: "Ù‚Ø³Ù… Ø§Ù„Ø¯Ø¬Ø§Ø¬", titleEn: "Chicken", img: "https://i.postimg.cc/htHd2rCn/roz-o-dajaj.gif", items: [ { nameAr: 'Ø­Ø¨Ø© Ø¯Ø¬Ø§Ø¬ Ø¨Ø±ÙˆØ³Øª', nameEn: 'Whole Broasted Chicken', price: 5200 }, { nameAr: 'Ù†ØµÙ Ø¯Ø¬Ø§Ø¬ Ø¨Ø±ÙˆØ³Øª', nameEn: 'Half Broasted Chicken', price: 2600 } ] },
            meat: { titleAr: "Ø§Ù„Ù„Ø­ÙˆÙ… ÙˆØ§Ù„Ù…Ø´Ø§ÙˆÙŠ", titleEn: "Meats", img: "https://i.postimg.cc/15XVPT26/hq720-(2).jpg", items: [ { nameAr: 'Ø±Ø¨Ø¹ Ø°Ø¨ÙŠØ­Ø© Ù„Ø­Ù… Ù…Ù†Ø¯ÙŠ', nameEn: '1/4 Mandi Meat', price: 11800 }, { nameAr: 'Ù…Ø´ÙƒÙ„ Ù…Ø´Ø§ÙˆÙŠ', nameEn: 'Mixed Grill', price: 7000 } ] },
            sides: { titleAr: "Ø§Ù„Ø£Ø±Ø² ÙˆØ§Ù„Ø§Ø¶Ø§ÙØ§Øª", titleEn: "Rice & Extras", img: "https://i.postimg.cc/HxTjNPXf/mndy-djaj.webp", items: [ { nameAr: 'Ø±Ø² Ø£Ø¨ÙŠØ¶', nameEn: 'White Rice', price: 600 }, { nameAr: 'Ù…Ù„ÙˆØ®ÙŠØ©', nameEn: 'Molokhia', price: 600 } ] }
        };

        // ================= LOGIC =================
        let cart = {}; 
        let totalAmount = 0;
        let userLocationLink = '';
        let userProfile = { name: '', phone: '', img: '', history: [], haptic: true }; // ğŸ—‘ï¸ REMOVED POINTS
        let currentLang = 'ar';
        let currentSlide = 0;
        let slideInterval;
        let directOffer = null; 
        let tempPaymentMethod = '';

        const Haptic = {
            trigger: (type) => {
                if(!userProfile.haptic) return;
                if(navigator.vibrate) {
                    if(type === 'soft') navigator.vibrate(10);
                    if(type === 'medium') navigator.vibrate(25);
                    if(type === 'heavy') navigator.vibrate([30, 50, 30]);
                }
            }
        };

        // ğŸŒ‰ Ø¬Ø³Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (Median + OneSignal Bridge)
        // Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙŠØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§ÙÙ‚ Ù…Ø³Ø¨Ù‚Ø§Ù‹
        function median_onesignal_init() {
             if (navigator.userAgent.indexOf('median') > -1 || navigator.userAgent.indexOf('gonative') > -1) {
                // Ø£Ù…Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©
                window.location.href = 'median://onesignal/register';
                
                // Ø£Ù…Ø± Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø© (Ù„Ù† ÙŠØ²Ø¹Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙˆØ§ÙÙ‚ Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ù„ÙƒÙ†Ù‡ ÙŠØ¶Ù…Ù† Ø§Ù„ØªÙØ¹ÙŠÙ„)
                setTimeout(function(){ 
                    window.location.href = 'median://onesignal/prompt'; 
                }, 3000);
            }
        }

        window.onload = function() {
            loadSettings();
            initHeroSection();
            renderAll();
            updateLanguageUI();
            
            // ğŸ‘‡ğŸ‘‡ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¬Ø³Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ğŸ‘‡ğŸ‘‡
            median_onesignal_init();
        };

        function renderAll() {
            renderOriginalPage(); 
            renderCategoriesGrid();
        }

        function loadSettings() {
            const saved = localStorage.getItem('ahlanUser');
            if(saved) {
                userProfile = JSON.parse(saved);
                document.getElementById('user-name').value = userProfile.name;
                document.getElementById('user-phone').value = userProfile.phone;
                if(userProfile.img) {
                    document.getElementById('profile-img').src = userProfile.img;
                    document.getElementById('profile-img').classList.remove('hidden');
                    document.getElementById('profile-placeholder').classList.add('hidden');
                }
                document.getElementById('haptic-toggle').checked = userProfile.haptic !== false;
                
                // ğŸ—‘ï¸ REMOVED updatePointsUI CALL
                renderHistory();
            }
            if(localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
                document.getElementById('dark-toggle').checked = true;
            }
            if(localStorage.getItem('lang')) currentLang = localStorage.getItem('lang');
        }

        function saveSettings() {
            userProfile.name = document.getElementById('user-name').value;
            userProfile.phone = document.getElementById('user-phone').value;
            localStorage.setItem('ahlanUser', JSON.stringify(userProfile));
        }

        function toggleHaptic() {
            userProfile.haptic = document.getElementById('haptic-toggle').checked;
            Haptic.trigger('medium');
            saveSettings();
        }

        function filterMenu(type) {
            Haptic.trigger('medium');
            document.querySelectorAll('.filter-chip').forEach(el => el.classList.replace('active', 'inactive'));
            document.getElementById(`filter-${type}`).classList.replace('inactive', 'active');
            
            document.querySelectorAll('section[id^="section-"]').forEach(sec => {
                const tags = sec.getAttribute('data-tags');
                if(type === 'all' || (tags && (tags.includes(type) || tags.includes('all')))) {
                    sec.style.display = 'block';
                } else {
                    sec.style.display = 'none';
                }
            });
        }

        function toggleLanguage() {
            Haptic.trigger('medium');
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            localStorage.setItem('lang', currentLang);
            updateLanguageUI();
            renderAll(); 
            initHeroSection(); 
        }

        function updateLanguageUI() {
            const t = LANG[currentLang];
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.getElementById('lang-btn').innerText = currentLang === 'ar' ? 'English' : 'Ø¹Ø±Ø¨ÙŠ';
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if(t[key]) {
                    if(el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = t[key];
                    else el.innerText = t[key];
                }
            });
        }

        function initHeroSection() {
            clearInterval(slideInterval);
            const c = document.getElementById('hero-container');
            const t = LANG[currentLang];
            
            let html = `<div class="hero-slider-container">`;
            html += window.OFFERS_DATA.map((o,i) => `
                <div class="slide ${i===0?'active':''}">
                    <img src="${o.img}" class="slide-img">
                    <div class="slide-content">
                        <h2 class="text-3xl md:text-5xl font-ruqaa text-brand-gold drop-shadow-lg mb-2">${currentLang==='ar'?o.titleAr:o.titleEn}</h2>
                        <span class="bg-black/50 text-white font-bold text-sm px-4 py-1 rounded-full mb-3 backdrop-blur-sm">${currentLang==='ar'?o.subtitleAr:o.subtitleEn}</span>
                        <button onclick="buyOffer(${o.id})" class="bg-brand-red text-white px-6 py-2 rounded-xl font-bold shadow-lg animate-bounce-slight hover:scale-105 transition">
                            ${t.get_offer} (${o.price})
                        </button>
                    </div>
                </div>
            `).join('');
            html += `<div class="slider-arrow arrow-left" onclick="moveSlide(-1)">â®</div><div class="slider-arrow arrow-right" onclick="moveSlide(1)">â¯</div><div class="slider-dots">${window.OFFERS_DATA.map((_,i) => `<div class="dot ${i===0?'active':''}" onclick="setSlide(${i})"></div>`).join('')}</div></div>`;
            c.innerHTML = html;
            currentSlide = 0;
            slideInterval = setInterval(() => moveSlide(1), 5000);
        }

        function moveSlide(dir) {
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.dot');
            slides[currentSlide].classList.remove('active');
            dots[currentSlide].classList.remove('active');
            currentSlide = (currentSlide + dir + slides.length) % slides.length;
            slides[currentSlide].classList.add('active');
            dots[currentSlide].classList.add('active');
        }

        function setSlide(idx) {
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.dot');
            slides[currentSlide].classList.remove('active');
            dots[currentSlide].classList.remove('active');
            currentSlide = idx;
            slides[currentSlide].classList.add('active');
            dots[currentSlide].classList.add('active');
            clearInterval(slideInterval);
            slideInterval = setInterval(() => moveSlide(1), 5000);
        }

        function buyOffer(id) {
            Haptic.trigger('heavy');
            const offer = window.OFFERS_DATA.find(o => o.id === id);
            directOffer = offer;
            const t = LANG[currentLang];
            document.getElementById('paymentModal').classList.add('modal-open');
            document.getElementById('step-review').classList.remove('hidden');
            document.getElementById('step-payment').classList.add('hidden');
            const title = currentLang === 'ar' ? offer.titleAr : offer.titleEn;
            document.getElementById('bill-items').innerHTML = `<div class="flex justify-between font-bold text-brand-red"><span>${t.offer_req}: ${title}</span><span>${offer.price}</span></div>`;
            document.getElementById('bill-total').innerText = offer.price.toLocaleString();
        }

        function addToCart(el, nameAr, price) {
            Haptic.trigger('soft');
            updateQty(nameAr, price, 1);
        }

        function updateQty(nameAr, price, change) {
            directOffer = null; 
            if(!cart[nameAr]) cart[nameAr] = 0;
            cart[nameAr] += change;
            if(cart[nameAr] < 0) cart[nameAr] = 0;
            if(cart[nameAr] === 0) delete cart[nameAr];
            if(change > 0) {
                const cartBtn = document.getElementById('center-cart-btn');
                cartBtn.classList.remove('popped');
                void cartBtn.offsetWidth; 
                cartBtn.classList.add('popped');
            }
            totalAmount = 0;
            Object.keys(cart).forEach(k => { 
                let p = price; 
                let found = false;
                for(let s in originalMenu) { let item = originalMenu[s].items.find(i=>i.nameAr===k); if(item) { p=item.price; found=true; break; } }
                if(!found) { for(let s in fullMenu) { let item = fullMenu[s].items.find(i=>i.nameAr===k); if(item) { p=item.price; found=true; break; } } }
                totalAmount += (cart[k] * p) 
            });
            updateUI();
        }

        function updateUI() {
            document.querySelectorAll('.qty-display').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.btn-remove').forEach(el => el.classList.add('hidden'));
            
            let totalItems = 0;
            Object.values(cart).forEach(qty => totalItems += qty);
            const badge = document.getElementById('cart-badge');
            if(totalItems > 0) {
                badge.innerText = totalItems;
                badge.classList.remove('scale-0');
            } else {
                badge.classList.add('scale-0');
            }
            Object.keys(cart).forEach(nameAr => {
                const safe = nameAr.replace(/\s+/g, '-');
                const qty = cart[nameAr];
                document.querySelectorAll(`[id^='ctrl-${safe}']`).forEach(el => {
                    el.querySelector('.btn-remove').classList.remove('hidden');
                    el.querySelector('.qty-display').classList.remove('hidden');
                    el.querySelector('.qty-display').innerText = qty;
                });
            });
            document.getElementById('mini-total').innerText = totalAmount.toLocaleString();
            const bar = document.getElementById('miniCheckoutBar');
            if(totalAmount > 0) bar.classList.add('visible');
            else bar.classList.remove('visible');
        }

        function clearCart() {
            if(confirm(LANG[currentLang].clear_cart)) {
                Haptic.trigger('medium');
                cart = {}; totalAmount = 0;
                updateUI();
                closePaymentModal();
            }
        }

        function openPaymentWizard() {
            Haptic.trigger('medium');
            const t = LANG[currentLang];
            if(totalAmount === 0 && !directOffer) return alert(t.empty_cart);
            document.getElementById('paymentModal').classList.add('modal-open');
            document.getElementById('step-review').classList.remove('hidden');
            document.getElementById('step-payment').classList.add('hidden');
            let html = '';
            Object.keys(cart).forEach(k => {
                 let displayName = k;
                 if(currentLang === 'en') {
                     for(let s in originalMenu) { const i=originalMenu[s].items.find(x=>x.nameAr===k); if(i) displayName=i.nameEn; }
                     for(let s in fullMenu) { const i=fullMenu[s].items.find(x=>x.nameAr===k); if(i) displayName=i.nameEn; }
                 }
                 html += `<div class="flex justify-between border-b border-gray-100 pb-2 dark:border-gray-700"><span>${displayName} (x${cart[k]})</span></div>`;
            });
            document.getElementById('bill-items').innerHTML = html;
            document.getElementById('bill-total').innerText = totalAmount.toLocaleString();
        }

        // ================= MODIFIED PAYMENT LOGIC =================
        function processPayment(method) {
            Haptic.trigger('heavy');
            const t = LANG[currentLang];
            if(!userLocationLink) { alert(t.location_alert); return; }
            
            tempPaymentMethod = method;

            // ğŸ›‘ CHECK FOR PAYMENT METHOD
            if(method === 'cash') {
                finalizePayment();
            } else {
                document.getElementById('reminder-modal').classList.add('modal-open');
            }
        }

        function confirmPaymentReminder() {
            closeReminderModal();
            finalizePayment();
        }

        function closeReminderModal() {
            document.getElementById('reminder-modal').classList.remove('modal-open');
        }

        function finalizePayment() {
            let finalPrice = directOffer ? directOffer.price : totalAmount;
            
            // ğŸ—‘ï¸ REMOVED LOYALTY CALCULATION

            if(!userProfile.history) userProfile.history = [];
            
            let orderSummary = directOffer ? (currentLang==='ar'?directOffer.titleAr:directOffer.titleEn) : Object.keys(cart).length + ' Items';
            userProfile.history.unshift({ 
                date: new Date().toLocaleDateString(), 
                total: finalPrice, 
                summary: orderSummary,
                items: directOffer ? null : JSON.parse(JSON.stringify(cart)) 
            });
            
            saveSettings(); 
            // ğŸ—‘ï¸ REMOVED updatePointsUI CALL
            renderHistory();

            // â• GET NOTES
            const notes = document.getElementById('order-notes').value;

            let msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (${tempPaymentMethod.toUpperCase()})*\n`;
            msg += `----------------\n`;
            if(directOffer) {
                msg += `ğŸ”¥ OFFER: ${directOffer.titleAr} - ${directOffer.price}\n`;
            } else {
                Object.keys(cart).forEach(k => msg += `â–ªï¸ ${k} (${cart[k]})\n`);
            }
            msg += `----------------\n`;
            // ğŸ“ ADD NOTES TO MSG
            if(notes && notes.trim() !== "") {
                msg += `ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„:\n"${notes}"\n`;
                msg += `----------------\n`;
            }
            msg += `ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${finalPrice.toLocaleString()} Ø±ÙŠØ§Ù„\n`;
            msg += `ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${userLocationLink}\n`;
            msg += `ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${userProfile.name} (${userProfile.phone})`;
            
            window.open(`https://wa.me/967779100056?text=${encodeURIComponent(msg)}`, '_blank');
            closePaymentModal();
            document.getElementById('order-notes').value = ''; // Reset notes
            if(directOffer) directOffer = null;
        }

        // ================= RENDER HELPERS =================
        function renderOriginalPage() {
            const keys = ['grills', 'folk', 'rice', 'edam', 'drinks'];
            document.getElementById('main-sections-container').innerHTML = keys.map(k => {
                 const data = originalMenu[k];
                 const title = currentLang==='ar' ? data.titleAr : data.titleEn;
                 let type = 'vertical';
                 if(k === 'grills') type='horizontal';
                 if(k === 'rice') type='large';
                 if(k === 'drinks') type='mini';
                 
                 let grid = "grid grid-cols-2 gap-4"; 
                 if(type === 'horizontal') grid = "grid grid-cols-1 md:grid-cols-2 gap-5";
                 if(type === 'large') grid = "grid gap-5";
                 if(type === 'mini') grid = "grid grid-cols-2 md:grid-cols-4 gap-3";
                 
                 return `
                    <section id="section-${k}" data-tags="${data.tags.join(',')},all">
                        <div class="flex items-center gap-3 mb-6 px-1">
                            <span class="text-3xl filter drop-shadow-sm">${data.icon}</span>
                            <h3 class="font-black text-2xl text-brand-dark dark:text-white">${title}</h3>
                        </div>
                        <div class="${grid}">
                            ${data.items.map(item => getCardHTML(item, type)).join('')}
                        </div>
                    </section>
                 `;
            }).join('');
        }

        function getCardHTML(item, type) {
            const name = currentLang==='ar' ? item.nameAr : item.nameEn;
            const desc = currentLang==='ar' ? (item.descAr||'') : (item.descEn||'');
            const onclick = `addToCart(this, '${item.nameAr}', ${item.price})`;
            const controls = getControls(item.nameAr, item.price, type==='mini'||type==='vertical');
            if(type === 'horizontal') return `<div class="clickable-card bg-white p-4 rounded-3xl shadow-soft border border-orange-50 flex gap-5 items-center dark:bg-gray-800 dark:border-gray-700" onclick="${onclick}"><img src="${item.img}" class="food-img shadow-md"><div class="flex-1 h-full flex flex-col justify-between py-1"><div><h4 class="font-black text-xl text-gray-800 leading-tight mb-1 dark:text-white">${name}</h4><p class="text-sm text-gray-500 font-medium">${desc}</p></div><div class="flex justify-between items-end mt-3"><span class="font-black text-brand-red text-2xl">${item.price} <span class="text-xs text-gray-400 font-bold">Ø±.ÙŠ</span></span>${controls}</div></div></div>`;
            else if (type === 'large') return `<div class="clickable-card bg-white rounded-3xl shadow-soft border border-orange-50 overflow-hidden flex flex-row-reverse dark:bg-gray-800 dark:border-gray-700" onclick="${onclick}"><div class="w-2/5"><img src="${item.img}" class="h-full w-full object-cover"></div><div class="w-3/5 p-5 flex flex-col justify-center items-start"><h4 class="font-black text-xl text-gray-800 dark:text-white">${name}</h4><p class="text-sm text-gray-400 mb-4 mt-1 font-medium">${desc}</p><div class="w-full flex justify-between items-end"><span class="text-2xl font-black text-brand-red">${item.price} <small class="text-gray-400 text-xs">Ø±.ÙŠ</small></span>${controls}</div></div></div>`;
            else return `<div class="clickable-card bg-white p-3 rounded-3xl shadow-soft border border-orange-50 text-center dark:bg-gray-800 dark:border-gray-700" onclick="${onclick}"><img src="${item.img}" class="w-full h-32 object-cover rounded-2xl mb-3 shadow-sm"><h4 class="font-bold text-gray-800 mb-2 dark:text-white">${name}</h4><div class="flex justify-between items-center px-1"><span class="text-brand-red font-black text-lg">${item.price} <small class="text-xs">Ø±.ÙŠ</small></span>${controls}</div></div>`;
        }

        function getControls(nameAr, price, small=false) {
            const safe = nameAr.replace(/\s+/g, '-');
            const cls = small ? "scale-75" : "";
            return `<div class="flex items-center gap-3" id="ctrl-${safe}"><button class="btn-control btn-remove hidden ${cls}" onclick="event.stopPropagation(); updateQty('${nameAr}', ${price}, -1)">-</button><span class="qty-display hidden" id="qty-${safe}">0</span><button class="btn-control btn-add ${cls}" onclick="event.stopPropagation(); updateQty('${nameAr}', ${price}, 1)">+</button></div>`;
        }

        function renderCategoriesGrid() {
            document.getElementById('categories-grid').innerHTML = Object.keys(fullMenu).map(k => {
                const c = fullMenu[k];
                const title = currentLang==='ar'?c.titleAr:c.titleEn;
                return `<div class="cat-card-new" onclick="openCategory('${k}')"><img src="${c.img}" class="cat-card-bg"><div class="cat-overlay"><h3 class="cat-title">${title}</h3></div></div>`;
            }).join('');
        }

        function openCategory(k) {
            Haptic.trigger('medium');
            const cat = fullMenu[k];
            document.getElementById('categories-grid').style.display = 'none';
            document.getElementById('category-detail').style.display = 'block';
            document.getElementById('cat-detail-title').innerText = currentLang==='ar'?cat.titleAr:cat.titleEn;
            document.getElementById('cat-header-img').src = cat.img;
            document.getElementById('full-menu-list').innerHTML = cat.items.map(item => {
                const name = currentLang==='ar'?item.nameAr:item.nameEn;
                return `<div class="menu-item-new dark:bg-gray-800 dark:border-gray-700" onclick="addToCart(this, '${item.nameAr}', ${item.price})"><div class="flex-1"><h4 class="font-bold text-gray-800 dark:text-white text-sm">${name}</h4></div><div class="flex flex-col items-end gap-2"><span class="menu-price-new dark:bg-gray-700 dark:text-red-400">${item.price} <small>Ø±.ÙŠ</small></span>${getControls(item.nameAr, item.price, true)}</div></div>`
            }).join('');
            updateUI();
        }

        // ğŸ—‘ï¸ REMOVED updatePointsUI Function

        // â• RENDER HISTORY UPDATED (ARCHIVE)
        function renderHistory() {
            // 1. Render Last 2 for Quick Reorder (RED ZONE)
            const quickContainer = document.getElementById('quick-history-list');
            const quickOrders = userProfile.history.slice(0, 2);
            if(quickOrders.length > 0) {
                quickContainer.innerHTML = quickOrders.map((h, i) => `
                    <div class="flex justify-between items-center bg-red-50 p-3 rounded-xl border border-red-100 dark:bg-gray-800 dark:border-gray-600">
                        <div>
                            <div class="text-xs font-bold text-gray-500">${h.date}</div>
                            <div class="text-xs font-bold text-brand-red">${h.summary}</div>
                        </div>
                        <button onclick="quickReorder(${i})" class="bg-white text-brand-red border border-red-200 px-3 py-1 rounded-lg text-xs font-black shadow-sm dark:bg-gray-700 dark:text-white dark:border-gray-500">
                             ğŸ”„
                        </button>
                    </div>
                `).join('');
            } else {
                quickContainer.innerHTML = `<span class="text-xs text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø¯ÙŠØ«Ø©</span>`;
            }

            // 2. Standard History List (BLUE ZONE - HIDDEN)
            const list = document.getElementById('history-list');
            const remainingOrders = userProfile.history; 
            
            if(remainingOrders.length === 0) {
                list.innerHTML = `<span class="text-xs text-gray-400">${LANG[currentLang].no_history}</span>`;
                return;
            }

            list.innerHTML = remainingOrders.map(h => `
                <div class="flex justify-between border-b border-gray-100 pb-2 mb-2 dark:border-gray-600">
                    <div class="text-right">
                        <div class="text-xs text-gray-400 font-bold">${h.date}</div>
                        <div class="text-sm font-bold text-gray-700 dark:text-gray-200">${h.summary}</div>
                    </div>
                    <div class="text-brand-gold font-black">${h.total}</div>
                </div>
            `).join('');
        }

        function quickReorder(idx) {
            const order = userProfile.history[idx];
            if(!order.items) return alert("Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø®Ø§ØµØ©");
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙŠØ§Øª Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„Ø³Ù„Ø©ØŸ")) {
                cart = order.items;
                totalAmount = 0;
                Object.keys(cart).forEach(k => { updateQty(k, 0, 0); });
                closeSettingsModal();
                Haptic.trigger('heavy');
                openPaymentWizard();
            }
        }

        function toggleArchive() {
            const c = document.getElementById('archive-container');
            const arrow = document.getElementById('archive-arrow');
            if(c.classList.contains('hidden')) {
                c.classList.remove('hidden');
                arrow.innerText = 'â–²';
            } else {
                c.classList.add('hidden');
                arrow.innerText = 'â–¼';
            }
        }

        function clearHistory() {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
                userProfile.history = []; // Complete Wipe
                saveSettings();
                renderHistory();
                alert('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­');
            }
        }

        function showCategoriesGrid() { document.getElementById('categories-grid').style.display = 'grid'; document.getElementById('category-detail').style.display = 'none'; }

        function switchView(v) {
            Haptic.trigger('medium');
            document.getElementById('view-main').style.display = v==='main'?'block':'none';
            document.getElementById('view-categories').style.display = v==='categories'?'block':'none';
            document.getElementById('btn-main').className = `tab-btn ${v==='main'?'active':'inactive'}`;
            document.getElementById('btn-categories').className = `tab-btn ${v==='categories'?'active':'inactive'}`;
        }

        function openSettingsModal() { Haptic.trigger('medium'); document.getElementById('settings-modal').classList.add('modal-open'); }
        function closeSettingsModal() { document.getElementById('settings-modal').classList.remove('modal-open'); }
        function openSearchModal() { Haptic.trigger('medium'); document.getElementById('search-modal').classList.add('modal-open'); document.getElementById('real-search-input').focus(); }
        function closeSearchModal() { document.getElementById('search-modal').classList.remove('modal-open'); }
        function toggleTheme() { Haptic.trigger('medium'); document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', document.documentElement.classList.contains('dark')?'dark':'light'); }

        function requestUserLocation() {
            const t = LANG[currentLang];
            const btn = document.getElementById('btn-location');
            btn.innerHTML = t.location_wait;
            if(navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    userLocationLink = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
                    btn.className = "w-full mb-6 bg-green-50 text-green-700 font-bold py-3 rounded-xl border border-green-200 flex justify-center items-center gap-2";
                    btn.innerHTML = t.location_done;
                }, () => { alert(t.location_fail); userLocationLink = 'Location_Failed'; btn.innerHTML = t.location_btn; });
            } else { alert('Unsupported'); }
        }

        function uploadImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    userProfile.img = e.target.result;
                    document.getElementById('profile-img').src = e.target.result;
                    document.getElementById('profile-img').classList.remove('hidden');
                    document.getElementById('profile-placeholder').classList.add('hidden');
                    saveSettings();
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function performSearch() {
            const q = document.getElementById('real-search-input').value.toLowerCase();
            const res = document.getElementById('search-results');
            if(q.length < 2) { res.innerHTML = ''; return; }
            let all = [];
            Object.values(originalMenu).forEach(s => all.push(...s.items));
            Object.values(fullMenu).forEach(s => all.push(...s.items));
            const matches = all.filter(i => i.nameAr.toLowerCase().includes(q) || i.nameEn.toLowerCase().includes(q));
            res.innerHTML = matches.map(i => {
                const name = currentLang==='ar'?i.nameAr:i.nameEn;
                return `<div class="menu-item-new dark:bg-gray-800 dark:border-gray-700" onclick="addToCart(this, '${i.nameAr}', ${i.price})"><div class="flex-1"><h4 class="font-bold text-gray-800 dark:text-white">${name}</h4></div><div class="flex items-center gap-3"><span class="font-bold text-brand-red">${i.price}</span>${getControls(i.nameAr, i.price, true)}</div></div>`
            }).join('');
            matches.forEach(i => updateUI(i.name));
        }

        function shareApp() {
             Haptic.trigger('medium');
             const t = LANG[currentLang];
             let msg = "";
             const items = Object.keys(cart);
             const myUrl = 'https://ahlan-wasahlan1.github.io/menu.-/';
             if(items.length > 0) {
                 const itemsList = items.join(' + ');
                 msg = `ÙŠØ§ Ø´Ø¨Ø§Ø¨ Ø£Ù†Ø§ Ø¨Ø·Ù„Ø¨ (${itemsList}) Ù…Ù† Ù…Ø·Ø¹Ù… Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹.. Ù…Ù† ÙŠØ·Ù„Ø¨ Ù…Ø¹ÙŠØŸ ğŸ˜‹\n${myUrl}`;
             } else {
                 msg = `Ø¬Ø±Ø¨ÙˆØ§ Ù…Ø·Ø¹Ù… Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! Ø£ÙƒÙ„ ÙŠÙ…Ù†ÙŠ Ø¹Ù„Ù‰ ÙƒÙŠÙÙƒ..\n${myUrl}`;
             }
             if(navigator.share) navigator.share({title:t.app_title, text:msg, url: myUrl});
             else window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`);
        }

        function goToPaymentStep() {
            document.getElementById('step-review').classList.add('hidden');
            document.getElementById('step-payment').classList.remove('hidden');
        }

        function backToReview() {
            document.getElementById('step-review').classList.remove('hidden');
            document.getElementById('step-payment').classList.add('hidden');
        }

        function closePaymentModal() { document.getElementById('paymentModal').classList.remove('modal-open'); directOffer = null; }
    </script>
</body>
</html>
